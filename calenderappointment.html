<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>manage appointment</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #515152 0%, #c7d2fe 100%);
        min-height: 100vh;
      }

      .navbar {
        background: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .navbar-content {
        max-width: 1280px;
        margin: 0 auto;
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .navbar h1 {
        font-size: 1.5rem;
        color: #1f2937;
      }

      .nav-buttons {
        display: flex;
        gap: 1rem;
      }

      .nav-btn {
        padding: 0.5rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        background: #e5e7eb;
        color: #374151;
      }

      .nav-btn.active {
        background: #4f46e5;
        color: white;
      }

      .nav-btn:hover:not(.active) {
        background: #d1d5db;
      }

      .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 1.5rem;
      }

      .card {
        background: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .card-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #1f2937;
      }

      .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-primary {
        background: #4f46e5;
        color: white;
      }

      .btn-primary:hover {
        background: #4338ca;
      }

      .btn-danger {
        background: #ef4444;
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .btn-success {
        background: #10b981;
        color: white;
      }

      .btn-success:hover {
        background: #059669;
      }

      .schedule-item,
      .appointment-item {
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
      }

      .schedule-info,
      .appointment-info {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        flex-wrap: wrap;
      }

      .badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 600;
      }

      .badge-blue {
        background: #dbeafe;
        color: #1e40af;
      }

      .badge-purple {
        background: #e9d5ff;
        color: #7c3aed;
      }

      .badge-green {
        background: #d1fae5;
        color: #047857;
      }

      .badge-red {
        background: #fee2e2;
        color: #dc2626;
      }

      .badge-indigo {
        background: #e0e7ff;
        color: #4338ca;
      }

      .actions {
        display: flex;
        gap: 0.5rem;
      }

      .icon-btn {
        padding: 0.5rem;
        border: none;
        background: none;
        cursor: pointer;
        border-radius: 0.5rem;
        transition: all 0.3s;
      }

      .icon-btn:hover {
        background: #f3f4f6;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 0.75rem;
        padding: 1.5rem;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #374151;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-size: 1rem;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .calendar-nav {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 0.5rem;
      }

      .calendar-day-header {
        text-align: center;
        font-weight: bold;
        color: #374151;
        padding: 0.5rem;
      }

      .calendar-day {
        aspect-ratio: 1;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 0.5rem;
        cursor: pointer;
        transition: all 0.3s;
      }

      .calendar-day:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .calendar-day.today {
        border-color: #4f46e5;
        background: #eef2ff;
      }

      .calendar-day.full {
        background: #f9fafb;
        cursor: not-allowed;
      }

      .calendar-day .date {
        font-size: 0.875rem;
        font-weight: 600;
      }

      .calendar-day .info {
        margin-top: 0.25rem;
        font-size: 0.75rem;
      }

      .week-view {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .week-day {
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
      }

      .week-day-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .time-slots {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 0.5rem;
      }

      .time-slot {
        padding: 0.75rem;
        border-radius: 0.5rem;
        text-align: center;
        font-weight: 600;
        font-size: 0.875rem;
      }

      .time-slot.available {
        background: #d1fae5;
        color: #047857;
      }

      .time-slot.occupied {
        background: #fee2e2;
        color: #dc2626;
      }

      .time-slot.selectable {
        cursor: pointer;
        transition: all 0.3s;
      }

      .time-slot.selectable:hover {
        transform: scale(1.05);
      }

      .time-slot.selected {
        background: #4f46e5;
        color: white;
      }

      .hidden {
        display: none;
      }

      .view-toggle {
        display: flex;
        gap: 0.5rem;
      }

      .edit-mode {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .edit-mode input {
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
      }

      @media (max-width: 768px) {
        .nav-buttons {
          flex-direction: column;
          gap: 0.5rem;
        }

        .calendar-grid {
          gap: 0.25rem;
        }

        .time-slots {
          grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        }

        .schedule-info,
        .appointment-info {
          flex-direction: column;
          align-items: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-content">
        <h1>Syst√®me de Rendez-vous M√©dical</h1>
        <div class="nav-buttons">
          <button class="nav-btn active" onclick="showPage('schedule')">
            üìÖ Horaires de Travail
          </button>
          <button class="nav-btn" onclick="showPage('calendar')">
            üë• Calendrier Patient
          </button>
          <button class="nav-btn" onclick="showPage('appointments')">
            üïê Rendez-vous
          </button>
        </div>
      </div>
    </nav>

    <div class="container">
      <!-- Page Horaires de Travail -->
      <div id="schedule-page">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Horaires de Travail du Docteur</h2>
            <button class="btn btn-primary" onclick="showAddHourModal()">
              ‚ûï Ajouter
            </button>
          </div>
          <div id="schedules-list"></div>
        </div>
      </div>

      <!-- Page Calendrier Patient -->
      <div id="calendar-page" class="hidden">
        <div class="card">
          <div class="calendar-header">
            <div class="calendar-nav">
              <button class="btn btn-primary" onclick="navigateDate(-1)">
                ‚óÄ
              </button>
              <h2 class="card-title" id="calendar-title"></h2>
              <button class="btn btn-primary" onclick="navigateDate(1)">
                ‚ñ∂
              </button>
            </div>
            <div class="view-toggle">
              <button class="btn" onclick="setViewMode('week')" id="week-btn">
                Semaine
              </button>
              <button
                class="btn btn-primary"
                onclick="setViewMode('month')"
                id="month-btn"
              >
                Mois
              </button>
            </div>
          </div>
          <div id="calendar-content"></div>
        </div>
      </div>

      <!-- Page Rendez-vous -->
      <div id="appointments-page" class="hidden">
        <div class="card">
          <h2 class="card-title" style="margin-bottom: 1.5rem">
            Tous les Rendez-vous
          </h2>
          <div id="appointments-list"></div>
        </div>
      </div>
    </div>

    <!-- Modal Ajouter Horaire -->
    <div id="add-hour-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Nouvel Horaire</h3>
          <button class="icon-btn" onclick="closeModal('add-hour-modal')">
            ‚úñ
          </button>
        </div>
        <div class="form-group">
          <label>Jour</label>
          <select id="new-day">
            <option value="">S√©lectionner un jour</option>
            <option value="1">Lundi</option>
            <option value="2">Mardi</option>
            <option value="3">Mercredi</option>
            <option value="4">Jeudi</option>
            <option value="5">Vendredi</option>
            <option value="6">Samedi</option>
            <option value="7">Dimanche</option>
          </select>
        </div>
        <div class="form-group">
          <label>Heure de d√©but</label>
          <input type="time" id="new-start-time" />
        </div>
        <div class="form-group">
          <label>Heure de fin</label>
          <input type="time" id="new-end-time" />
        </div>
        <div class="form-group">
          <label>Dur√©e cr√©neau (minutes)</label>
          <input type="number" id="new-slot-duration" value="30" />
        </div>
        <div class="form-group">
          <label>Nombre maximum de patients</label>
          <input type="number" id="new-max-patients" value="10" />
        </div>
        <button
          class="btn btn-primary"
          style="width: 100%"
          onclick="addWorkingHour()"
        >
          Ajouter
        </button>
      </div>
    </div>

    <!-- Modal R√©server Rendez-vous -->
    <div id="booking-modal" class="modal">
      <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
          <h3>R√©server un Rendez-vous</h3>
          <button class="icon-btn" onclick="closeModal('booking-modal')">
            ‚úñ
          </button>
        </div>
        <p style="margin-bottom: 1rem">
          <strong>Date:</strong> <span id="booking-date"></span>
        </p>
        <div
          id="booking-time-slots"
          class="time-slots"
          style="margin-bottom: 1.5rem"
        ></div>
        <div id="booking-form" class="hidden">
          <div class="form-group">
            <label>Nom du patient *</label>
            <input type="text" id="patient-name" />
          </div>
          <div class="form-group">
            <label>T√©l√©phone</label>
            <input type="tel" id="patient-phone" />
          </div>
          <div class="form-group">
            <label>Motif de consultation</label>
            <textarea id="patient-reason" rows="3"></textarea>
          </div>
          <button
            class="btn btn-primary"
            style="width: 100%"
            onclick="bookAppointment()"
          >
            Confirmer le Rendez-vous
          </button>
        </div>
      </div>
    </div>

    <script>
      // √âtat de l'application
      let state = {
        currentPage: "schedule",
        viewMode: "month",
        currentDate: new Date(),
        workingHours: [
          {
            id: 1,
            dayOfWeek: 1,
            dayName: "Lundi",
            startTime: "09:00",
            endTime: "17:00",
            slotDuration: 30,
            maxPatients: 16,
          },
          {
            id: 2,
            dayOfWeek: 2,
            dayName: "Mardi",
            startTime: "09:00",
            endTime: "17:00",
            slotDuration: 30,
            maxPatients: 16,
          },
          {
            id: 3,
            dayOfWeek: 3,
            dayName: "Mercredi",
            startTime: "09:00",
            endTime: "13:00",
            slotDuration: 30,
            maxPatients: 8,
          },
          {
            id: 4,
            dayOfWeek: 4,
            dayName: "Jeudi",
            startTime: "09:00",
            endTime: "17:00",
            slotDuration: 30,
            maxPatients: 16,
          },
          {
            id: 5,
            dayOfWeek: 5,
            dayName: "Vendredi",
            startTime: "09:00",
            endTime: "16:00",
            slotDuration: 30,
            maxPatients: 14,
          },
        ],
        appointments: [
          {
            id: 1,
            patientName: "Jean Dupont",
            date: "2024-12-16",
            time: "10:00",
            phone: "0612345678",
            reason: "Consultation",
          },
          {
            id: 2,
            patientName: "Marie Martin",
            date: "2024-12-17",
            time: "14:30",
            phone: "0687654321",
            reason: "Suivi",
          },
        ],
        editingHour: null,
        selectedSlot: null,
      };

      // Utilitaires
      function formatDate(date) {
        return date.toLocaleDateString("fr-FR", {
          weekday: "long",
          day: "numeric",
          month: "long",
          year: "numeric",
        });
      }

      function formatDateShort(date) {
        return date.toLocaleDateString("fr-FR");
      }

      function dateToString(date) {
        return date.toISOString().split("T")[0];
      }

      function generateTimeSlots(startTime, endTime, duration) {
        const slots = [];
        const [startHour, startMin] = startTime.split(":").map(Number);
        const [endHour, endMin] = endTime.split(":").map(Number);

        let currentTime = startHour * 60 + startMin;
        const endTimeMin = endHour * 60 + endMin;

        while (currentTime < endTimeMin) {
          const hours = Math.floor(currentTime / 60);
          const mins = currentTime % 60;
          slots.push(
            `${hours.toString().padStart(2, "0")}:${mins
              .toString()
              .padStart(2, "0")}`
          );
          currentTime += duration;
        }
        return slots;
      }

      function getWorkingHoursForDay(date) {
        const dayOfWeek = date.getDay() === 0 ? 7 : date.getDay();
        return state.workingHours.find((wh) => wh.dayOfWeek === dayOfWeek);
      }

      function getPatientCountForDay(date) {
        const dateStr = dateToString(date);
        return state.appointments.filter((apt) => apt.date === dateStr).length;
      }

      function isDayFull(date) {
        const workHours = getWorkingHoursForDay(date);
        if (!workHours) return true;
        const patientCount = getPatientCountForDay(date);
        return patientCount >= workHours.maxPatients;
      }

      function isSlotAvailable(date, time) {
        const dateStr = dateToString(date);
        return !state.appointments.some(
          (apt) => apt.date === dateStr && apt.time === time
        );
      }

      // Navigation
      function showPage(page) {
        state.currentPage = page;
        document
          .getElementById("schedule-page")
          .classList.toggle("hidden", page !== "schedule");
        document
          .getElementById("calendar-page")
          .classList.toggle("hidden", page !== "calendar");
        document
          .getElementById("appointments-page")
          .classList.toggle("hidden", page !== "appointments");

        document.querySelectorAll(".nav-btn").forEach((btn, idx) => {
          const pages = ["schedule", "calendar", "appointments"];
          btn.classList.toggle("active", pages[idx] === page);
        });

        if (page === "schedule") renderSchedules();
        if (page === "calendar") renderCalendar();
        if (page === "appointments") renderAppointments();
      }

      function setViewMode(mode) {
        state.viewMode = mode;
        document
          .getElementById("week-btn")
          .classList.toggle("btn-primary", mode === "week");
        document
          .getElementById("week-btn")
          .classList.toggle("btn", mode !== "week");
        document
          .getElementById("month-btn")
          .classList.toggle("btn-primary", mode === "month");
        document
          .getElementById("month-btn")
          .classList.toggle("btn", mode !== "month");
        renderCalendar();
      }

      function navigateDate(direction) {
        if (state.viewMode === "month") {
          state.currentDate.setMonth(state.currentDate.getMonth() + direction);
        } else {
          state.currentDate.setDate(
            state.currentDate.getDate() + direction * 7
          );
        }
        renderCalendar();
      }

      // Modales
      function showAddHourModal() {
        document.getElementById("add-hour-modal").classList.add("active");
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("active");
      }

      // CRUD Horaires
      function renderSchedules() {
        const list = document.getElementById("schedules-list");
        list.innerHTML = state.workingHours
          .sort((a, b) => a.dayOfWeek - b.dayOfWeek)
          .map(
            (wh) => `
                <div class="schedule-item">
                    ${
                      state.editingHour === wh.id
                        ? `
                        <div class="edit-mode">
                            <input type="text" value="${wh.dayName}" id="edit-name-${wh.id}">
                            <input type="time" value="${wh.startTime}" id="edit-start-${wh.id}">
                            <input type="time" value="${wh.endTime}" id="edit-end-${wh.id}">
                            <input type="number" value="${wh.slotDuration}" id="edit-duration-${wh.id}">
                            <input type="number" value="${wh.maxPatients}" id="edit-max-${wh.id}">
                        </div>
                        <button class="btn btn-success" onclick="saveWorkingHour(${wh.id})">üíæ Sauvegarder</button>
                    `
                        : `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="schedule-info">
                                <span style="font-weight: bold; font-size: 1.125rem; color: #4f46e5;">${wh.dayName}</span>
                                <span style="color: #374151;">${wh.startTime} - ${wh.endTime}</span>
                                <span class="badge badge-blue">Cr√©neaux de ${wh.slotDuration} min</span>
                                <span class="badge badge-purple">Max: ${wh.maxPatients} patients</span>
                            </div>
                            <div class="actions">
                                <button class="icon-btn" onclick="editWorkingHour(${wh.id})" style="color: #3b82f6;">‚úèÔ∏è</button>
                                <button class="icon-btn" onclick="deleteWorkingHour(${wh.id})" style="color: #ef4444;">üóëÔ∏è</button>
                            </div>
                        </div>
                    `
                    }
                </div>
            `
          )
          .join("");
      }

      function addWorkingHour() {
        const dayOfWeek = document.getElementById("new-day").value;
        const startTime = document.getElementById("new-start-time").value;
        const endTime = document.getElementById("new-end-time").value;
        const slotDuration = parseInt(
          document.getElementById("new-slot-duration").value
        );
        const maxPatients = parseInt(
          document.getElementById("new-max-patients").value
        );

        if (!dayOfWeek || !startTime || !endTime) {
          alert("Veuillez remplir tous les champs obligatoires");
          return;
        }

        const dayNames = [
          "",
          "Lundi",
          "Mardi",
          "Mercredi",
          "Jeudi",
          "Vendredi",
          "Samedi",
          "Dimanche",
        ];

        state.workingHours.push({
          id: Date.now(),
          dayOfWeek: parseInt(dayOfWeek),
          dayName: dayNames[dayOfWeek],
          startTime,
          endTime,
          slotDuration,
          maxPatients,
        });

        closeModal("add-hour-modal");
        renderSchedules();

        // Reset form
        document.getElementById("new-day").value = "";
        document.getElementById("new-start-time").value = "";
        document.getElementById("new-end-time").value = "";
        document.getElementById("new-slot-duration").value = "30";
        document.getElementById("new-max-patients").value = "10";
      }

      function editWorkingHour(id) {
        state.editingHour = id;
        renderSchedules();
      }

      function saveWorkingHour(id) {
        const wh = state.workingHours.find((w) => w.id === id);
        wh.dayName = document.getElementById(`edit-name-${id}`).value;
        wh.startTime = document.getElementById(`edit-start-${id}`).value;
        wh.endTime = document.getElementById(`edit-end-${id}`).value;
        wh.slotDuration = parseInt(
          document.getElementById(`edit-duration-${id}`).value
        );
        wh.maxPatients = parseInt(
          document.getElementById(`edit-max-${id}`).value
        );
        state.editingHour = null;
        renderSchedules();
      }

      function deleteWorkingHour(id) {
        if (confirm("√ätes-vous s√ªr de vouloir supprimer cet horaire ?")) {
          state.workingHours = state.workingHours.filter((wh) => wh.id !== id);
          renderSchedules();
        }
      }

      // Calendrier
      function renderCalendar() {
        const title = document.getElementById("calendar-title");
        const content = document.getElementById("calendar-content");

        if (state.viewMode === "month") {
          title.textContent = state.currentDate.toLocaleDateString("fr-FR", {
            month: "long",
            year: "numeric",
          });
          content.innerHTML = renderMonthView();
        } else {
          const weekDays = getWeekDays(state.currentDate);
          title.textContent = `Semaine du ${formatDateShort(weekDays[0])}`;
          content.innerHTML = renderWeekView();
        }
      }

      function getDaysInMonth(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const days = [];

        const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;

        for (let i = 0; i < startDay; i++) {
          days.push(null);
        }

        for (let day = 1; day <= lastDay.getDate(); day++) {
          days.push(new Date(year, month, day));
        }

        return days;
      }

      function getWeekDays(date) {
        const days = [];
        const currentDay = date.getDay();
        const monday = new Date(date);
        monday.setDate(
          date.getDate() - (currentDay === 0 ? 6 : currentDay - 1)
        );

        for (let i = 0; i < 7; i++) {
          const day = new Date(monday);
          day.setDate(monday.getDate() + i);
          days.push(day);
        }
        return days;
      }

      function renderMonthView() {
        const daysOfWeek = ["Lun", "Mar", "Mer", "Jeu", "Ven", "Sam", "Dim"];
        const days = getDaysInMonth(state.currentDate);
        const today = new Date();

        let html = '<div class="calendar-grid">';

        daysOfWeek.forEach((day) => {
          html += `<div class="calendar-day-header">${day}</div>`;
        });

        days.forEach((day) => {
          if (!day) {
            html += "<div></div>";
            return;
          }

          const workHours = getWorkingHoursForDay(day);
          const isToday = day.toDateString() === today.toDateString();
          const patientCount = getPatientCountForDay(day);
          const isFull = isDayFull(day);

          const classes = ["calendar-day"];
          if (isToday) classes.push("today");
          if (isFull || !workHours) classes.push("full");

          html += `
                    <div class="${classes.join(" ")}" onclick="${
            workHours && !isFull ? `openBooking('${dateToString(day)}')` : ""
          }">
                        <div class="date">${day.getDate()}</div>
                        ${
                          workHours
                            ? `
                            <div class="info">
                                ${
                                  !isFull
                                    ? `
                                    <div style="color: #047857;">‚úì Disponible</div>
                                    <div style="color: #6b7280;">${workHours.startTime}-${workHours.endTime}</div>
                                    <div style="color: #7c3aed; font-weight: 600;">${patientCount}/${workHours.maxPatients}</div>
                                `
                                    : `
                                    <div style="color: #dc2626;">‚úó Complet</div>
                                    <div style="color: #dc2626; font-weight: 600;">${patientCount}/${workHours.maxPatients}</div>
                                `
                                }
                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
        });

        html += "</div>";
        return html;
      }

      function renderWeekView() {
        const weekDays = getWeekDays(state.currentDate);

        return `<div class="week-view">${weekDays
          .map((day) => {
            const workHours = getWorkingHoursForDay(day);
            const dateStr = dateToString(day);
            const patientCount = getPatientCountForDay(day);
            const isFull = isDayFull(day);

            return `
                    <div class="week-day">
                        <div class="week-day-header">
                            <div>
                                <h3 style="font-size: 1.125rem; font-weight: bold;">${formatDate(
                                  day
                                )}</h3>
                                ${
                                  workHours
                                    ? `
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-top: 0.5rem;">
                                        <p style="font-size: 0.875rem; color: #6b7280;">${
                                          workHours.startTime
                                        } - ${workHours.endTime}</p>
                                        <span class="badge ${
                                          isFull ? "badge-red" : "badge-purple"
                                        }">
                                            ${patientCount}/${
                                        workHours.maxPatients
                                      } patients
                                        </span>
                                    </div>
                                `
                                    : ""
                                }
                            </div>
                            ${
                              workHours && !isFull
                                ? `
                                <button class="btn btn-primary" onclick="openBooking('${dateStr}')">R√©server</button>
                            `
                                : isFull
                                ? `
                                <span class="badge badge-red" style="padding: 0.5rem 1rem;">Complet</span>
                            `
                                : ""
                            }
                        </div>
                        ${
                          workHours
                            ? `
                            <div class="time-slots">
                                ${generateTimeSlots(
                                  workHours.startTime,
                                  workHours.endTime,
                                  workHours.slotDuration
                                )
                                  .map((time) => {
                                    const available = isSlotAvailable(
                                      day,
                                      time
                                    );
                                    return `
                                        <div class="time-slot ${
                                          available ? "available" : "occupied"
                                        }">
                                            ${time}
                                        </div>
                                    `;
                                  })
                                  .join("")}
                            </div>
                        `
                            : '<p style="text-align: center; color: #6b7280; padding: 1rem;">Jour non travaill√©</p>'
                        }
                    </div>
                `;
          })
          .join("")}</div>`;
      }

      function openBooking(dateStr) {
        const date = new Date(dateStr + "T12:00:00");
        const workHours = getWorkingHoursForDay(date);

        if (!workHours || isDayFull(date)) return;

        state.selectedSlot = { date: dateStr, workHours };

        document.getElementById("booking-date").textContent =
          formatDateShort(date);
        document.getElementById("booking-modal").classList.add("active");

        renderTimeSlots();
      }

      function renderTimeSlots() {
        const slots = generateTimeSlots(
          state.selectedSlot.workHours.startTime,
          state.selectedSlot.workHours.endTime,
          state.selectedSlot.workHours.slotDuration
        );

        const date = new Date(state.selectedSlot.date + "T12:00:00");
        const slotsHtml = slots
          .map((time) => {
            const available = isSlotAvailable(date, time);
            const selected = state.selectedSlot.time === time;

            return `
                    <div class="time-slot ${
                      available ? "available selectable" : "occupied"
                    } ${selected ? "selected" : ""}"
                         onclick="${
                           available ? `selectTimeSlot('${time}')` : ""
                         }">
                        ${time}
                    </div>
                `;
          })
          .join("");

        document.getElementById("booking-time-slots").innerHTML = slotsHtml;
      }

      function selectTimeSlot(time) {
        state.selectedSlot.time = time;
        renderTimeSlots();
        document.getElementById("booking-form").classList.remove("hidden");
      }

      function bookAppointment() {
        const patientName = document.getElementById("patient-name").value;
        const phone = document.getElementById("patient-phone").value;
        const reason = document.getElementById("patient-reason").value;

        if (!patientName || !state.selectedSlot.time) {
          alert("Veuillez remplir le nom du patient et s√©lectionner une heure");
          return;
        }

        state.appointments.push({
          id: Date.now(),
          patientName,
          phone,
          reason,
          date: state.selectedSlot.date,
          time: state.selectedSlot.time,
        });

        closeModal("booking-modal");

        // Reset form
        document.getElementById("patient-name").value = "";
        document.getElementById("patient-phone").value = "";
        document.getElementById("patient-reason").value = "";
        document.getElementById("booking-form").classList.add("hidden");
        state.selectedSlot = null;

        renderCalendar();
      }

      // Rendez-vous
      function renderAppointments() {
        const list = document.getElementById("appointments-list");
        const sorted = [...state.appointments].sort(
          (a, b) =>
            new Date(a.date + " " + a.time) - new Date(b.date + " " + b.time)
        );

        if (sorted.length === 0) {
          list.innerHTML =
            '<p style="text-align: center; color: #6b7280; padding: 2rem;">Aucun rendez-vous</p>';
          return;
        }

        list.innerHTML = sorted
          .map(
            (apt) => `
                <div class="appointment-item">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                <span class="badge badge-indigo">${new Date(
                                  apt.date
                                ).toLocaleDateString("fr-FR")}</span>
                                <span class="badge badge-blue">${
                                  apt.time
                                }</span>
                            </div>
                            <h3 style="font-size: 1.25rem; font-weight: bold; color: #1f2937;">${
                              apt.patientName
                            }</h3>
                            <p style="color: #6b7280;">üìû ${
                              apt.phone || "Not renseign√©"
                            }</p>
                            <p style="color: #374151;"><strong>Motif:</strong> ${
                              apt.reason || "Not sp√©cifi√©"
                            }</p>
                        </div>
                        <button class="icon-btn" onclick="deleteAppointment(${
                          apt.id
                        })" style="color: #ef4444;">üóëÔ∏è</button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function deleteAppointment(id) {
        if (confirm("are you sur remove this appiontment ?")) {
          state.appointments = state.appointments.filter(
            (apt) => apt.id !== id
          );
          renderAppointments();
          if (state.currentPage === "calendar") renderCalendar();
        }
      }

      // Initialisation
      window.addEventListener("DOMContentLoaded", () => {
        showPage("schedule");
      });
    </script>
  </body>
</html>

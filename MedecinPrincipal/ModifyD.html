<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modifier Docteur</title>
  <link rel="stylesheet" href="ModifyD.css">
  <script>
    
    function loadDoctorData() {
      const doctorData = localStorage.getItem('currentDoctor');
      if (doctorData) {
        const doctor = JSON.parse(doctorData);
        document.querySelector('input[type="text"]').value = doctor.name || '';
        document.querySelectorAll('input[type="text"]')[1].value = doctor.speciality || '';
        document.querySelectorAll('input[type="text"]')[2].value = doctor.phone || '';
        document.querySelector('input[type="email"]').value = doctor.email || '';
        document.getElementById('status').value = doctor.status || '';
      }
    }

    
    function validateForm() {
      const name = document.querySelector('input[type="text"]').value.trim();
      const speciality = document.querySelectorAll('input[type="text"]')[1].value.trim();
      const phone = document.querySelectorAll('input[type="text"]')[2].value.trim();
      const email = document.querySelector('input[type="email"]').value.trim();
      const status = document.getElementById('status').value;

     
      if (name.length < 2) {
        showError('Le nom doit contenir au moins 2 caractères');
        return false;
      }

      
      if (speciality.length < 3) {
        showError('La spécialité doit contenir au moins 3 caractères');
        return false;
      }

      
      const phoneRegex = /^[0-9]{10}$/;
      if (!phoneRegex.test(phone.replace(/\s/g, ''))) {
        showError('Le numéro de téléphone doit contenir 10 chiffres');
        return false;
      }

      
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showError('Veuillez entrer une adresse email valide');
        return false;
      }

     
      if (!status) {
        showError('Veuillez sélectionner un statut');
        return false;
      }

      return true;
    }

    
    function showError(message) {
      
      const existingError = document.querySelector('.error-message');
      if (existingError) {
        existingError.remove();
      }

      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.textContent = message;
      errorDiv.style.cssText = `
        color: #d32f2f;
        background-color: #ffebee;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        border: 1px solid #f44336;
      `;

      const form = document.querySelector('form');
      form.insertBefore(errorDiv, form.firstChild);

      
      setTimeout(() => {
        errorDiv.remove();
      }, 5000);
    }

   
    function showSuccess(message) {
      const successDiv = document.createElement('div');
      successDiv.className = 'success-message';
      successDiv.textContent = message;
      successDiv.style.cssText = `
        color: #2e7d32;
        background-color: #e8f5e9;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        border: 1px solid #4caf50;
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      `;

      document.body.appendChild(successDiv);

      
      setTimeout(() => {
        successDiv.remove();
      }, 3000);
    }

    
    function saveDoctorData() {
      const doctorData = {
        name: document.querySelector('input[type="text"]').value.trim(),
        speciality: document.querySelectorAll('input[type="text"]')[1].value.trim(),
        phone: document.querySelectorAll('input[type="text"]')[2].value.trim(),
        email: document.querySelector('input[type="email"]').value.trim(),
        status: document.getElementById('status').value,
        lastModified: new Date().toISOString()
      };

      localStorage.setItem('currentDoctor', JSON.stringify(doctorData));
      
     
      updateDoctorsList(doctorData);
    }

    
    function updateDoctorsList(updatedDoctor) {
      const doctors = JSON.parse(localStorage.getItem('doctors')) || [];
      const index = doctors.findIndex(doctor => doctor.email === updatedDoctor.email);
      
      if (index !== -1) {
        doctors[index] = updatedDoctor;
      } else {
        doctors.push(updatedDoctor);
      }
      
      localStorage.setItem('doctors', JSON.stringify(doctors));
    }

   
    function handleSubmit(event) {
      event.preventDefault();
      
      
      if (!validateForm()) {
        return;
      }

      
      saveDoctorData();

      
      showSuccess('Docteur modifié avec succès!');

      const status = document.getElementById("status").value;
      
      
      setTimeout(() => {
        if (status === "Admin") {
          window.location.href = "ConfirmAdmin.html";
        } 
        else if (status === "Normal") {
          window.location.href = "ChooseAdmin.html";
        }
      }, 1000);
    }

    
    function trackFormChanges() {
      const inputs = document.querySelectorAll('input, select');
      let originalData = {};

      
      inputs.forEach(input => {
        originalData[input.id || input.name] = input.value;
      });

      
      window.addEventListener('beforeunload', function(e) {
        let hasChanges = false;
        
        inputs.forEach(input => {
          const currentValue = input.value;
          const originalValue = originalData[input.id || input.name];
          
          if (currentValue !== originalValue) {
            hasChanges = true;
          }
        });

        if (hasChanges) {
          e.preventDefault();
          e.returnValue = 'Vous avez des modifications non sauvegardées. Êtes-vous sûr de vouloir quitter?';
        }
      });
    }

    
    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
          e.preventDefault();
          handleSubmit(new Event('submit'));
        }
      });
    }

    
    document.addEventListener('DOMContentLoaded', function() {
      loadDoctorData();
      trackFormChanges();
      setupKeyboardShortcuts();
      
      
      const inputs = document.querySelectorAll('input');
      inputs[0].placeholder = 'Entrez le nom du docteur';
      inputs[1].placeholder = 'Ex: Cardiologie, Dermatologie...';
      inputs[2].placeholder = 'Ex: 0123456789';
      inputs[3].placeholder = 'exemple@clinique.com';
    });

    
    console.log('Module de modification de docteur chargé');
  </script>
</head>
<body>

  <div class="card">
    <h2>Modifier un Docteur</h2>

    <form onsubmit="handleSubmit(event)">
      <label>Nom :</label>
      <input type="text" required>

      <label>Spécialité :</label>
      <input type="text" required>

      <label>Téléphone :</label>
      <input type="text" required>

      <label>Email :</label>
      <input type="email" required>

      <label>Statut :</label>
      <select id="status" required>
        <option value="">-- Choisir --</option>
        <option value="Normal">Normal</option>
        <option value="Admin">Admin</option>
      </select>

      <button type="submit">OK</button>
    </form>
  </div>

</body>
</html>
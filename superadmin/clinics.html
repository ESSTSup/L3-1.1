<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinics Management - Clinic Management</title>
    <link rel="stylesheet" href="superadmin.css">
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Clinic Manager</h2>
                <p>Super Admin Dashboard</p>
            </div>
            <ul class="sidebar-menu">
                <li><a href="index.html"><i>üìä</i> <span>Dashboard</span></a></li>
                <li><a href="clinics.html" class="active"><i>üè•</i> <span>Clinics</span></a></li>
                <li><a href="subscriptions.html"><i>üí∞</i> <span>Subscriptions</span></a></li>
                <li><a href="requests.html"><i>üìã</i> <span>Requests</span></a></li>
                <li><a href="archived.html"><i>üóÑÔ∏è</i> <span>Archived</span></a></li>
                <li><a href="#"><i>‚öôÔ∏è</i> <span>Settings</span></a></li>
            </ul>
        </div>

        <div class="main-content">
            <div class="header">
                <h1>Clinics Management</h1>
                <div class="user-info">
                    <span>Super Admin</span>
                    <div class="user-avatar">SA</div>
                </div>
            </div>

            <div class="page-title">Manage Clinics</div>
            <p class="page-description">Create, edit, and manage all clinics in the system.</p>

            <div class="table-container">
                <div class="table-header">
                    <h2>Clinics List</h2>
                    <div class="table-actions">
                        <button class="btn btn-primary" id="addClinicBtn">
                            <i>+</i> Add New Clinic
                        </button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Clinic ID</th>
                            <th>Clinic Name</th>
                            <th>Location</th>
                            <th>Contact</th>
                            <th>Plan</th>
                            <th>Accessibility</th>
                            <th>Status</th>
                            <th>GPS Coordinates</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="clinic-id">CL001</span></td>
                            <td>MediCare Center</td>
                            <td>New York, NY</td>
                            <td>contact@medicare.com</td>
                            <td><span class="plan-badge plan-premium">Premium</span></td>
                            <td><span class="status active">Handicap Friendly</span></td>
                            <td><span class="status active">Active</span></td>
                            <td>40.7128¬∞ N, 74.0060¬∞ W</td>
                            <td>
                                <a href="clinic-edit.html" class="btn btn-sm btn-outline">Edit</a>
                                <a href="clinic-info.html?id=CL001" class="btn btn-sm btn-outline">Information</a>
                                <button class="btn btn-sm btn-danger delete-clinic" data-id="CL001">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="clinic-id">CL002</span></td>
                            <td>HealthPlus Clinic</td>
                            <td>Los Angeles, CA</td>
                            <td>info@healthplus.com</td>
                            <td><span class="plan-badge plan-premium">Premium</span></td>
                            <td><span class="status pending">Not Accessible</span></td>
                            <td><span class="status active">Active</span></td>
                            <td>34.0522¬∞ N, 118.2437¬∞ W</td>
                            <td>
                                <a href="clinic-edit.html" class="btn btn-sm btn-outline">Edit</a>
                                <a href="clinic-info.html?id=CL002" class="btn btn-sm btn-outline">Information</a>
                                <button class="btn btn-sm btn-danger delete-clinic" data-id="CL002">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="clinic-id">CL003</span></td>
                            <td>Family Care Center</td>
                            <td>Chicago, IL</td>
                            <td>admin@familycare.com</td>
                            <td><span class="plan-badge plan-free">Free</span></td>
                            <td><span class="status active">Handicap Friendly</span></td>
                            <td><span class="status active">Active</span></td>
                            <td>41.8781¬∞ N, 87.6298¬∞ W</td>
                            <td>
                                <a href="clinic-edit.html" class="btn btn-sm btn-outline">Edit</a>
                                <a href="clinic-information.html" class="btn btn-sm btn-outline">Information</a>
                                <button class="btn btn-sm btn-danger delete-clinic">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Clinic Modal -->
    <div class="modal" id="addClinicModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Clinic</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addClinicForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clinicId">Clinic ID *</label>
                            <input type="text" id="clinicId" class="form-control" required placeholder="e.g., CL004">
                        </div>
                        <div class="form-group">
                            <label for="clinicName">Clinic Name *</label>
                            <input type="text" id="clinicName" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clinicEmail">Clinic Email *</label>
                            <input type="email" id="clinicEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="principalDoctorEmail">Principal Doctor Email *</label>
                            <input type="email" id="principalDoctorEmail" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clinicPassword">Clinic Password *</label>
                            <div class="password-field">
                                <input type="password" id="clinicPassword" class="form-control" required>
                                <button type="button" class="toggle-password" onclick="togglePassword('clinicPassword')">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password *</label>
                            <div class="password-field">
                                <input type="password" id="confirmPassword" class="form-control" required>
                                <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword')">üëÅÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clinicPhone">Phone *</label>
                            <input type="tel" id="clinicPhone" class="form-control" required 
                                   placeholder="e.g., 0551234567" 
                                   pattern="[0-9]{10}"
                                   title="Please enter a valid Algerian phone number (10 digits starting with 05, 06, or 07)">
                            <small class="phone-hint" style="color: var(--gray); font-size: 0.8rem; margin-top: 5px; display: block;">
                                Must be 10 digits starting with 05, 06, or 07
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="numberOfDoctors">Number of Doctors *</label>
                            <input type="number" id="numberOfDoctors" class="form-control" required min="1" max="100" value="1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clinicAddress">Address *</label>
                            <input type="text" id="clinicAddress" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="clinicCity">City *</label>
                            <input type="text" id="clinicCity" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clinicState">State *</label>
                            <input type="text" id="clinicState" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="handicapAccessible">Handicap Accessibility *</label>
                            <select id="handicapAccessible" class="form-control" required>
                                <option value="handicap-friendly">Handicap Friendly</option>
                                <option value="not-accessible">Not Accessible</option>
                                <option value="partial">Partially Accessible</option>
                            </select>
                        </div>
                    </div>
                    <!-- GPS Location Section -->
                    <div class="gps-section">
                        <h4>GPS Location</h4>
                        <p class="page-description">Set the clinic's geographic coordinates for mapping and location services.</p>
                        
                        <div class="gps-controls">
                            <button type="button" class="btn-location" id="getCurrentLocationBtn">
                                <span class="location-icon">üìç</span> Use Current Location
                            </button>
                            <div class="gps-input-group">
                                <input type="text" id="gpsLatitude" class="form-control" placeholder="Latitude" required>
                                <input type="text" id="gpsLongitude" class="form-control" placeholder="Longitude" required>
                            </div>
                        </div>
                        
                        <div class="gps-map" id="gpsMapPreview">
                            Map preview will appear here when coordinates are set
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="subscriptionPlan">Subscription Plan *</label>
                        <select id="subscriptionPlan" class="form-control" required>
                            <option value="free">Free</option>
                            <option value="premium">Premium</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline modal-close">Cancel</button>
                <button class="btn btn-primary" id="saveClinicBtn">Save Clinic</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Clinic</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this clinic?</p>
                <div class="confirmation-details">
                    <div class="detail-item">
                        <span class="detail-label">Clinic Name:</span>
                        <span class="detail-value" id="deleteClinicName"></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Clinic ID:</span>
                        <span class="detail-value" id="deleteClinicId"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline modal-close">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Delete Clinic</button>
            </div>
        </div>
    </div>

    <script>
       
        function isValidAlgerianPhone(phone) {
       
            const cleanPhone = phone.replace(/\D/g, '');
            
         
            if (cleanPhone.length !== 10) {
                return false;
            }
            
           
            const validPrefixes = ['05', '06', '07'];
            const prefix = cleanPhone.substring(0, 2);
            
            return validPrefixes.includes(prefix);
        }

     
        function formatPhoneNumber(input) {
            // Remove all non-digit characters
            let value = input.value.replace(/\D/g, '');
        
            if (value.length > 10) {
                value = value.substring(0, 10);
            }
            

            input.value = value;
            
          
            const phoneHint = input.parentElement.querySelector('.phone-hint');
            if (value.length === 0) {
                input.style.borderColor = '';
                if (phoneHint) phoneHint.style.color = 'var(--gray)';
            } else if (isValidAlgerianPhone(value)) {
                input.style.borderColor = 'var(--secondary)';
                if (phoneHint) phoneHint.style.color = 'var(--secondary-dark)';
            } else {
                input.style.borderColor = 'var(--danger)';
                if (phoneHint) phoneHint.style.color = 'var(--danger-dark)';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
          
            const addClinicBtn = document.getElementById('addClinicBtn');
            const addClinicModal = document.getElementById('addClinicModal');
            
            if (addClinicBtn) {
                addClinicBtn.addEventListener('click', function() {
                    addClinicModal.classList.add('active');
                });
            }

           
            const clinicPhoneInput = document.getElementById('clinicPhone');
            if (clinicPhoneInput) {
                clinicPhoneInput.addEventListener('input', function() {
                    formatPhoneNumber(this);
                });
                
                clinicPhoneInput.addEventListener('blur', function() {
                    formatPhoneNumber(this);
                });
            }

    
            const deleteButtons = document.querySelectorAll('.delete-clinic');
            const deleteModal = document.getElementById('deleteConfirmModal');
            const deleteClinicName = document.getElementById('deleteClinicName');
            const deleteClinicId = document.getElementById('deleteClinicId');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

            deleteButtons.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    const clinicId = this.getAttribute('data-id');
                    const clinicName = this.closest('tr').cells[1].textContent;
                    
                    deleteClinicName.textContent = clinicName;
                    deleteClinicId.textContent = clinicId;
                    deleteModal.classList.add('active');
                });
            });

            if (confirmDeleteBtn) {
                confirmDeleteBtn.addEventListener('click', function() {
                    const clinicId = deleteClinicId.textContent;
                    const clinicName = deleteClinicName.textContent;
                    
                    // Remove clinic from table
                    const rows = document.querySelectorAll('tbody tr');
                    rows.forEach(function(row) {
                        if (row.querySelector('.clinic-id').textContent === clinicId) {
                            row.remove();
                        }
                    });
                    
                    alert('Clinic "' + clinicName + '" deleted successfully!');
                    deleteModal.classList.remove('active');
                });
            }

           
            const saveClinicBtn = document.getElementById('saveClinicBtn');
            if (saveClinicBtn) {
                saveClinicBtn.addEventListener('click', function() {
                 
                    const clinicId = document.getElementById('clinicId').value.trim();
                    const clinicName = document.getElementById('clinicName').value.trim();
                    const clinicEmail = document.getElementById('clinicEmail').value.trim();
                    const principalDoctorEmail = document.getElementById('principalDoctorEmail').value.trim();
                    const clinicPassword = document.getElementById('clinicPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    const clinicPhone = document.getElementById('clinicPhone').value.trim();
                    const numberOfDoctors = document.getElementById('numberOfDoctors').value.trim();
                    const clinicAddress = document.getElementById('clinicAddress').value.trim();
                    const clinicCity = document.getElementById('clinicCity').value.trim();
                    const clinicState = document.getElementById('clinicState').value.trim();
                    const gpsLat = document.getElementById('gpsLatitude').value.trim();
                    const gpsLng = document.getElementById('gpsLongitude').value.trim();
                    
                 
                    const requiredFields = [
                        { value: clinicId, name: 'Clinic ID' },
                        { value: clinicName, name: 'Clinic Name' },
                        { value: clinicEmail, name: 'Clinic Email' },
                        { value: principalDoctorEmail, name: 'Principal Doctor Email' },
                        { value: clinicPassword, name: 'Clinic Password' },
                        { value: confirmPassword, name: 'Confirm Password' },
                        { value: clinicPhone, name: 'Phone' },
                        { value: numberOfDoctors, name: 'Number of Doctors' },
                        { value: clinicAddress, name: 'Address' },
                        { value: clinicCity, name: 'City' },
                        { value: clinicState, name: 'State' },
                        { value: gpsLat, name: 'GPS Latitude' },
                        { value: gpsLng, name: 'GPS Longitude' }
                    ];
                    
                    for (let field of requiredFields) {
                        if (!field.value) {
                            alert(`${field.name} is required!`);
                            return;
                        }
                    }
                    
                    function isValidEmail(email) {
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        return emailRegex.test(email);
                    }
                    
                    if (!isValidEmail(clinicEmail)) {
                        alert('Please enter a valid clinic email address (must contain @ and domain extension)');
                        return;
                    }
                    
                    if (!isValidEmail(principalDoctorEmail)) {
                        alert('Please enter a valid principal doctor email address (must contain @ and domain extension)');
                        return;
                    }
                    
                
                    if (!isValidAlgerianPhone(clinicPhone)) {
                        alert('Please enter a valid Algerian phone number:\n\n‚Ä¢ Must be 10 digits\n‚Ä¢ Must start with 05, 06, or 07\n\nExample: 0551234567');
                        document.getElementById('clinicPhone').focus();
                        return;
                    }
                    
                
                    if (clinicPassword !== confirmPassword) {
                        alert('Passwords do not match!');
                        return;
                    }
                   
                    if (clinicPassword.length < 6) {
                        alert('Password must be at least 6 characters long!');
                        return;
                    }
                    
              
                    if (numberOfDoctors < 1) {
                        alert('Number of doctors must be at least 1!');
                        return;
                    }
                    
                    if (numberOfDoctors > 100) {
                        alert('Number of doctors cannot exceed 100!');
                        return;
                    }
                    
                    if (!Number.isInteger(Number(numberOfDoctors))) {
                        alert('Number of doctors must be a whole number!');
                        return;
                    }
                    
                 
                    if (!gpsLat || !gpsLng) {
                        alert('Please set GPS coordinates for the clinic. Use "Use Current Location" or enter coordinates manually.');
                        return;
                    }
                    
                   
                    if (isNaN(gpsLat) || isNaN(gpsLng)) {
                        alert('Please enter valid GPS coordinates. Latitude and longitude must be numbers.');
                        return;
                    }
                    
                  
                    if (gpsLat < -90 || gpsLat > 90) {
                        alert('Please enter a valid latitude between -90 and 90 degrees.');
                        return;
                    }
                    
                 
                    if (gpsLng < -180 || gpsLng > 180) {
                        alert('Please enter a valid longitude between -180 and 180 degrees.');
                        return;
                    }
                    
             
                    alert('Clinic "' + clinicName + '" created successfully with ID: ' + clinicId + 
                          '\nNumber of Doctors: ' + numberOfDoctors +
                          '\nPhone: ' + clinicPhone +
                          '\nGPS Coordinates: ' + gpsLat + ', ' + gpsLng);
                    addClinicModal.classList.remove('active');
                    document.getElementById('addClinicForm').reset();
                    
              
                    const gpsMapPreview = document.getElementById('gpsMapPreview');
                    if (gpsMapPreview) {
                        gpsMapPreview.innerHTML = 'Map preview will appear here when coordinates are set';
                    }
                });
            }

        
            const closeButtons = document.querySelectorAll('.modal-close');
            closeButtons.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.modal').forEach(function(modal) {
                        modal.classList.remove('active');
                    });
                });
            });

         
            document.querySelectorAll('.modal').forEach(function(modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        });

        const getCurrentLocationBtn = document.getElementById('getCurrentLocationBtn');
        const gpsLatitude = document.getElementById('gpsLatitude');
        const gpsLongitude = document.getElementById('gpsLongitude');
        const gpsMapPreview = document.getElementById('gpsMapPreview');

        if (getCurrentLocationBtn) {
            getCurrentLocationBtn.addEventListener('click', function() {
                if (navigator.geolocation) {
                    getCurrentLocationBtn.innerHTML = '<span class="location-icon">‚è≥</span> Getting Location...';
                    getCurrentLocationBtn.disabled = true;
                    
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            
                            gpsLatitude.value = lat.toFixed(6);
                            gpsLongitude.value = lng.toFixed(6);
                            
                            // Update map preview
                            gpsMapPreview.innerHTML = `
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 10px;">üìç</div>
                                    <div>Latitude: ${lat.toFixed(6)}</div>
                                    <div>Longitude: ${lng.toFixed(6)}</div>
                                    <div style="margin-top: 10px; font-size: 12px; color: #888;">
                                        Location captured successfully
                                    </div>
                                </div>
                            `;
                            
                            getCurrentLocationBtn.innerHTML = '<span class="location-icon">üìç</span> Use Current Location';
                            getCurrentLocationBtn.disabled = false;
                        },
                        function(error) {
                            console.error("Error getting location:", error);
                            alert("Could not get your current location. Please enter coordinates manually.");
                            getCurrentLocationBtn.innerHTML = '<span class="location-icon">üìç</span> Use Current Location';
                            getCurrentLocationBtn.disabled = false;
                        }
                    );
                } else {
                    alert("Geolocation is not supported by this browser. Please enter coordinates manually.");
                }
            });
        }

      
        [gpsLatitude, gpsLongitude].forEach(input => {
            if (input) {
                input.addEventListener('input', function() {
                    if (gpsLatitude.value && gpsLongitude.value) {
                        gpsMapPreview.innerHTML = `
                            <div style="text-align: center;">
                                <div style="font-size: 24px; margin-bottom: 10px;">üìç</div>
                                <div>Latitude: ${gpsLatitude.value}</div>
                                <div>Longitude: ${gpsLongitude.value}</div>
                                <div style="margin-top: 10px; font-size: 12px; color: #888;">
                                    Coordinates set manually
                                </div>
                            </div>
                        `;
                    }
                });
            }
        });

   
        function togglePassword(fieldId) {
            const passwordField = document.getElementById(fieldId);
            const toggleButton = passwordField.nextElementSibling;
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleButton.textContent = 'üôà';
            } else {
                passwordField.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        }
    </script>
</body>
</html>
